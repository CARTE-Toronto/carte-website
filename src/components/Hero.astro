---
import { Image } from 'astro:assets';
import heroImage from '../assets/hero-image.jpg';

// Generate organic shape values at build/render time for eager loading
function generateOrganicShape() {
  const tl = Math.floor(Math.random() * 40) + 30;
  const tr = Math.floor(Math.random() * 40) + 30;
  const br = Math.floor(Math.random() * 40) + 30;
  const bl = Math.floor(Math.random() * 40) + 30;
  
  const tl2 = Math.floor(Math.random() * 40) + 30;
  const tr2 = Math.floor(Math.random() * 40) + 30;
  const br2 = Math.floor(Math.random() * 40) + 30;
  const bl2 = Math.floor(Math.random() * 40) + 30;

  return `${tl}% ${tr}% ${br}% ${bl}% / ${tl2}% ${tr2}% ${br2}% ${bl2}%`;
}

const organicShapeBorderRadius = generateOrganicShape();

// Rotating tagline words - applied/engineering-focused vocabulary emphasizing CARTE's practical, industry-oriented mission
const taglineWords = [
  'Engineering', 'Solutions', 'Industry', 'Implementation', 'Practice', 'Deployment',
  'Scale', 'Production', 'Teams', 'Organizations', 'Operations', 'Infrastructure',
  'Application', 'Impact', 'Partnership', 'Innovation', 'Excellence', 'Results'
];
const initialWord = taglineWords[Math.floor(Math.random() * taglineWords.length)];
---
<div class="relative bg-transparent overflow-visible">
  <div class="max-w-7xl mx-auto overflow-visible">
    <div class="relative z-10 pb-8 sm:pb-16 md:pb-20 lg:max-w-2xl lg:w-full lg:pb-28 xl:pb-32 pt-20 overflow-visible">
      <main class="mt-10 mx-auto max-w-7xl px-4 sm:mt-12 sm:px-6 md:mt-16 lg:mt-20 lg:px-8 xl:mt-28 overflow-visible">
        <div class="sm:text-center lg:text-left overflow-visible">
          <h1 class="text-5xl tracking-tight font-extrabold text-uoft-blue sm:text-6xl md:text-7xl leading-tight">
            <span class="block xl:inline">Where AI Meets</span>
            <span id="tagline-word" class="block text-uoft-accent xl:inline" data-words={JSON.stringify(taglineWords)}>{initialWord}</span>
          </h1>
          <p class="mt-6 text-lg text-gray-600 sm:mt-8 sm:text-xl sm:max-w-xl sm:mx-auto md:mt-8 md:text-xl lg:mx-0 font-normal leading-relaxed">
            We help organizations apply AI to real engineering challenges â€” through training, research partnerships, and collaboration with 100+ faculty across 8 engineering departments.
          </p>
          <div class="mt-8 sm:mt-10 sm:flex sm:justify-center lg:justify-start gap-4">
            <div class="rounded-full shadow-lg hover:shadow-xl transition-shadow">
              <a href="/partnerships" class="w-full flex items-center justify-center px-8 py-4 border border-transparent text-lg font-medium rounded-full text-white bg-uoft-blue hover:bg-uoft-accent md:py-4 md:text-lg md:px-10 font-sans transition-all duration-300">
                Partner With Us
              </a>
            </div>
            <div class="">
              <a href="/training" class="w-full flex items-center justify-center px-8 py-4 border-2 border-uoft-blue text-lg font-medium rounded-full text-uoft-blue bg-transparent hover:bg-blue-50 md:py-4 md:text-lg md:px-10 font-sans transition-colors">
                Train Your Team
              </a>
            </div>
          </div>
          
          <!-- Newsletter signup -->
          <details class="mt-8 sm:mt-10 group sm:text-center lg:text-left relative">
            <summary class="inline-flex items-center gap-2 text-sm text-gray-500 hover:text-uoft-blue cursor-pointer list-none select-none transition-colors">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
              </svg>
              <span>Subscribe to our newsletter</span>
              <svg class="w-3 h-3 transition-transform duration-200 group-open:rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
              </svg>
            </summary>
            
            <div class="absolute left-0 sm:left-1/2 lg:left-0 sm:-translate-x-1/2 lg:translate-x-0 top-full mt-2 z-[9999] p-5 bg-white backdrop-blur-md rounded-xl border border-slate-200 shadow-2xl w-[calc(100vw-2rem)] sm:w-[400px] newsletter-panel">
              <form 
                action="https://utoronto.us6.list-manage.com/subscribe/post?u=2aa2e869966773113b0712d28&amp;id=14f41f6d2f&amp;f_id=0012c2e1f0" 
                method="post" 
                target="_blank"
                class="space-y-3"
              >
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                  <input 
                    type="email" 
                    name="EMAIL" 
                    placeholder="Email *" 
                    class="px-3 py-2 rounded-lg border border-slate-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none text-sm"
                    required
                  />
                  <input 
                    type="text" 
                    name="FNAME" 
                    placeholder="First name"
                    class="px-3 py-2 rounded-lg border border-slate-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none text-sm"
                  />
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                  <input 
                    type="text" 
                    name="COMPANY" 
                    placeholder="Organization (if not UofT)"
                    class="px-3 py-2 rounded-lg border border-slate-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none text-sm"
                  />
                  <select 
                    name="MMERGE3"
                    class="px-3 py-2 rounded-lg border border-slate-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none text-sm bg-white text-slate-500"
                  >
                    <option value="">Academic Unit (if UofT)</option>
                    <option value="Applied Science &amp; Engineering">Applied Science & Engineering</option>
                    <option value="Arts &amp; Science">Arts & Science</option>
                    <option value="Medicine">Medicine</option>
                    <option value="Management">Management</option>
                    <option value="Other">Other</option>
                  </select>
                </div>
                <div class="flex flex-wrap gap-x-4 gap-y-1 text-xs text-slate-500">
                  <label class="flex items-center gap-1.5 cursor-pointer">
                    <input type="checkbox" name="group[12960][4]" class="rounded border-slate-300 text-indigo-600 w-3.5 h-3.5" />
                    <span>Graduate</span>
                  </label>
                  <label class="flex items-center gap-1.5 cursor-pointer">
                    <input type="checkbox" name="group[12960][2]" class="rounded border-slate-300 text-indigo-600 w-3.5 h-3.5" />
                    <span>Faculty</span>
                  </label>
                  <label class="flex items-center gap-1.5 cursor-pointer">
                    <input type="checkbox" name="group[12960][8]" class="rounded border-slate-300 text-indigo-600 w-3.5 h-3.5" />
                    <span>Postdoc</span>
                  </label>
                  <label class="flex items-center gap-1.5 cursor-pointer">
                    <input type="checkbox" name="group[12960][128]" class="rounded border-slate-300 text-indigo-600 w-3.5 h-3.5" />
                    <span>External</span>
                  </label>
                </div>
                <!-- Honeypot -->
                <div style="position: absolute; left: -5000px;" aria-hidden="true">
                  <input type="text" name="b_2aa2e869966773113b0712d28_14f41f6d2f" tabindex="-1" value="" />
                </div>
                <button 
                  type="submit" 
                  class="w-full px-4 py-2 bg-uoft-blue text-white text-sm font-semibold rounded-lg hover:bg-uoft-accent transition-colors"
                >
                  Subscribe
                </button>
              </form>
            </div>
          </details>
        </div>
      </main>
    </div>
  </div>
  
  <!-- Soft organic shape for the image container -->
  <div class="lg:absolute lg:inset-y-0 lg:right-0 lg:w-1/2 p-4 lg:p-12 flex items-center justify-center">
     <div class="w-full h-96 lg:h-full bg-gradient-to-br from-uoft-blue to-uoft-accent shadow-2xl flex items-center justify-center overflow-hidden relative organic-shape" style={`border-radius: ${organicShapeBorderRadius}`}>
        <Image src={heroImage} alt="CARTE" class="w-full h-full object-cover" loading="eager" />
        <div class="absolute inset-0 bg-gradient-to-br from-uoft-blue/40 to-uoft-accent/40"></div>
     </div>
  </div>
</div>

<script>
  // Regenerate shape on view transitions to maintain randomness across navigations
  function generateOrganicShape() {
    const tl = Math.floor(Math.random() * 40) + 30;
    const tr = Math.floor(Math.random() * 40) + 30;
    const br = Math.floor(Math.random() * 40) + 30;
    const bl = Math.floor(Math.random() * 40) + 30;
    
    const tl2 = Math.floor(Math.random() * 40) + 30;
    const tr2 = Math.floor(Math.random() * 40) + 30;
    const br2 = Math.floor(Math.random() * 40) + 30;
    const bl2 = Math.floor(Math.random() * 40) + 30;

    const shape = document.querySelector('.organic-shape') as HTMLElement;
    if (shape) {
      shape.style.borderRadius = `${tl}% ${tr}% ${br}% ${bl}% / ${tl2}% ${tr2}% ${br2}% ${bl2}%`;
    }
  }

  // Randomize tagline word on view transitions
  function randomizeTaglineWord() {
    const wordElement = document.getElementById('tagline-word');
    if (wordElement) {
      const words = JSON.parse(wordElement.dataset.words || '[]');
      if (words.length > 0) {
        wordElement.textContent = words[Math.floor(Math.random() * words.length)];
      }
    }
  }

  // Only regenerate on view transitions (not initial load, since it's already set)
  document.addEventListener('astro:page-load', () => {
    generateOrganicShape();
    randomizeTaglineWord();
  });
</script>
